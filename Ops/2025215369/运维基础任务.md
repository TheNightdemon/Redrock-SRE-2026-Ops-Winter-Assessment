## 运维基础任务

本学期我们学习了Linux以及计算机网络，因此本次运维基础任务就来检验一下大家的学习成果如何

**出题人**：哦耶耶耶

### 背景

网校新上线了一批业务服务器，需要在不同网络环境下完成初始网络配置：

- 服务器要求部署在
  - 自动获取地址的办公网络
  - 业务隔离的生产网络
- 不同环境下的IP地址、子网掩码、网关、DNS配置不同
- 生产网要求**严禁访问公网**

**网络地址规划**

|          | 值              |
| -------- | --------------- |
| 网卡     | eth0            |
| IP地址   | 172.22.146.150  |
| 子网掩码 | 255.255.255.0   |
| 网段     | 172.22.146.0/24 |
| 默认网关 | 172.22.146.1    |
| 主DNS    | 172.22.146.53   |
| 备DNS    | 172.22.146.54   |

### 任务要求

请你编写一个或多个Linux下的bash脚本，完成服务器在不同网络环境下的网络配置和验证工作

### 基本要求

- **所有操作**必须通过脚本完成
- 禁止手动修改网络配置文件
- 要求脚本可重复执行、**可回滚**

### 任务一：基础网络配置

**办公网络配置**
网卡`eth0`要求使用DHCP获取网络配置，自动获取IP地址、子网掩码、默认网关以及DNS服务器

**生产网络配置**
给`eth0`配置以下的静态参数：

- IP地址：`172.22.146.150`
- 子网掩码：`255.255.255.0`
- 网段：`172.22.146.0/24`

**生产网络中系统网络配置**

- 配置网关为`172.22.146.1`
- 配置系统DNS为`172.22.146.53`和`172.22.146.54`

编写脚本支持通过参数切换网络模式

- `dhcp`:办公网络模式
- `static`:生产网络模式
- 参数不合法时输出使用说明

### 任务二：生产网络隔离

编写脚本通过修改防火墙规则或者路由策略实现生产网络访问控制

**允许访问**

- 同一内网网段地址(`172.22.146.0/24`)
- 内部网络地址(`172.16.0.0/12`)

**禁止访问**公网地址

### 任务三：自动检测与切换

处于生产网络时，每分钟检测一次eth0能否访问公网。

如果可达说明生产网络存在违规公网访问，要求能够实现自动切换回办公网络模式。

**在脚本编写的过程中，合理添加日志记录是非常重要的，它能够有效地帮助我们排查错误和定位问题。**

**因此，请在你的脚本中加入适当的日志记录机制。**