# 主循环

## 后台监控的主循环 

*check_loop*

1. 取出启用的监控项
2. 判断是否到期 *is_due*
3. 根据监控类型执行检测
4. 记录结果并警告
5. 休眠一段时间

## 判断监控项是否到达检查时间 

*is_due*

- 需要检测
1. 没有任何记录
2. 距离上次检查时间超过间隔时间

## 写入监控结果

*record_result*

1. *monitor["id"]*        *# 监控项ID*
2. *status*               *# 状态*
3. *latency_ms*           *# 延迟*
4. *status_code*          *# HTTP状态码(非HTTP为None)*
5. *error*                *# 错误信息*
6. *checked_at*           *# 检查时间*


# 监控探测

## 根据监控类型进行探测

*run_check*

1. *check_http*      *# HTTP 探测*
2. *check_tcp*       *# TCP 端口探测*
3. *check_ping*      *# ICMP Ping 探测*
4. *check_dns*       *# DNS 解析探测*


# 警告

## 根据状态与阈值判断是否触发警告

*is_alert*

如果状态错误或延迟超出阈值，构造并发送 Webhook 警告

## 发送 Webhook 警告

*send_webhook*


# 后端接口API

## 创建监控项

*create_monitor*

## 更新监控项

*update_monitor*

## 删除监控项

*delete_monitor*

## 获取监控项最近结果

*get_results*

## 返回状态页上的数据

*status_page_data*

向前端返回监控项及其最新结果


# 数据库操作

## 初始化数据库

*init_db*

## 查询多行结果

*fetch_all*

## 查询单行结果

*fetch_one*

## 执行sql语句

*execute*


